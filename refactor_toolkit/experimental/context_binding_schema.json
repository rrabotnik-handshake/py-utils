{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Maps script outputs to RESPONSE_BLUEPRINTS.md template variables",
  "error_handling": {
    "invalid_format": {
      "action": "use_default",
      "log_level": "error"
    },
    "missing_source": {
      "action": "use_fallback",
      "log_level": "warning"
    },
    "transformation_error": {
      "action": "use_raw_value",
      "log_level": "error"
    }
  },
  "examples": {
    "expected_output": {
      "checks_passed": 6,
      "issues_summary": "Review failed checks and address issues",
      "next_actions": "Review failed checks and address issues",
      "project_name": "my-project",
      "status": "\u26a0\ufe0f Needs attention",
      "total_checks": 8,
      "validation_time": "45s"
    },
    "json_input": {
      "final_recommendation": {
        "next_actions": "Review failed checks and address issues",
        "status": "\u26a0\ufe0f NEEDS ATTENTION"
      },
      "metadata": {
        "project_name": "my-project",
        "tech_stack": "python",
        "timestamp": "2024-09-30T14:00:00Z",
        "validation_time": "45s"
      },
      "summary": {
        "failed_checks": 2,
        "overall_result": "some_failed",
        "passed_checks": 6,
        "total_checks": 8
      }
    },
    "machine_input": [
      "VALIDATION_RESULT:FAIL",
      "TOTAL_CHECKS:8",
      "PASSED_CHECKS:6",
      "FAILED_CHECKS:2",
      "PROJECT:my-project",
      "TIMESTAMP:2024-09-30T14:00:00Z"
    ]
  },
  "last_updated": "2024-09-30",
  "output_formats": {
    "human": {
      "content_type": "text/plain",
      "description": "Human-readable console output",
      "parser": "regex_extraction"
    },
    "json": {
      "content_type": "application/json",
      "description": "Structured JSON output from validation scripts",
      "parser": "json"
    },
    "machine": {
      "content_type": "text/plain",
      "delimiter": ":",
      "description": "Key-value pairs for machine parsing",
      "parser": "key_value"
    }
  },
  "template_mappings": {
    "comprehensive_assessment": {
      "section": "Comprehensive Assessment",
      "template_file": "RESPONSE_BLUEPRINTS.md",
      "variables": {
        "final_recommendation": {
          "status": {
            "mapping": {
              "FAIL": "\u274c NOT READY",
              "PASS": "\u2705 PRODUCTION READY",
              "all_passed": "\u2705 PRODUCTION READY",
              "critical_failed": "\u274c NOT READY",
              "some_failed": "\u26a0\ufe0f NEEDS ATTENTION"
            },
            "sources": {
              "human": {
                "regex": "(\u2705 PRODUCTION READY|\u26a0\ufe0f NEEDS ATTENTION|\u274c NOT READY)"
              },
              "json": "$.final_recommendation.status",
              "machine": "VALIDATION_RESULT"
            }
          },
          "summary": {
            "sources": {
              "human": {
                "multiline": true,
                "regex": "\ud83d\udcca Validation Summary\\n[=]+\\n(.+?)(?=\\n\\n|$)"
              },
              "json": "$.final_recommendation.next_actions",
              "machine": "VALIDATION_RESULT:(.+)"
            }
          }
        },
        "metadata": {
          "date": {
            "format": "iso8601",
            "sources": {
              "human": "{{current_timestamp}}",
              "json": "$.metadata.timestamp",
              "machine": "TIMESTAMP"
            }
          },
          "project_name": {
            "sources": {
              "human": "{{current_directory}}",
              "json": "$.metadata.project_name",
              "machine": "PROJECT"
            },
            "transform": "basename"
          },
          "tech_stack": {
            "sources": {
              "human": {
                "regex": "Technology: (.+)"
              },
              "json": "$.metadata.tech_stack",
              "machine": "TECH_STACK"
            }
          },
          "validation_time": {
            "format": "duration_string",
            "sources": {
              "human": {
                "regex": "Duration: (.+)"
              },
              "json": "$.metadata.validation_time",
              "machine": "DURATION"
            }
          }
        },
        "validation_results": {
          "fields": {
            "layer_name": {
              "human_group": 1,
              "json_path": "$.layer_name",
              "machine_group": 1
            },
            "results_summary": {
              "human_group": 2,
              "json_path": "$.results",
              "machine_group": 2
            },
            "status": {
              "human_regex": "(PASS|FAIL|\u2705|\u274c)",
              "json_path": "$.results[*].status",
              "machine_group": 2
            },
            "time_taken": {
              "human_regex": "\\((\\d+)s\\)",
              "json_path": "$.results[*].duration",
              "machine_regex": ":(\\d+):"
            }
          },
          "sources": {
            "human": {
              "multiline": true,
              "regex": "\ud83d\udcdd (.+?)\\n(.+?)(?=\ud83d\udcdd|\ud83d\udcca|$)"
            },
            "json": "$.layer_results",
            "machine": "LAYER:(.+):(.+)"
          },
          "type": "array"
        }
      }
    },
    "mini_assessment": {
      "section": "Mini Validation Report",
      "template_file": "RESPONSE_BLUEPRINTS.md",
      "variables": {
        "checks_passed": {
          "sources": {
            "human": {
              "regex": "Passed: (\\d+)",
              "type": "integer"
            },
            "json": "$.summary.passed_checks",
            "machine": "PASSED_CHECKS"
          }
        },
        "issues_summary": {
          "required_if": "status != '\u2705 Ready'",
          "sources": {
            "human": {
              "multiline": true,
              "regex": "Failed checks:\\n(.+?)\\n\\n"
            },
            "json": "$.final_recommendation.next_actions",
            "machine": "LAYER:.*:FAIL"
          }
        },
        "next_actions": {
          "default": "All checks passed - ready for deployment",
          "required_if": "status != '\u2705 Ready'",
          "sources": {
            "human": {
              "multiline": true,
              "regex": "Next Steps:\\n(.+?)$"
            },
            "json": "$.final_recommendation.next_actions",
            "machine": "VALIDATION_RESULT:FAIL"
          }
        },
        "project_name": {
          "sources": {
            "human": {
              "fallback": "{{current_directory}}",
              "regex": "Project: (.+)"
            },
            "json": "$.metadata.project_name",
            "machine": "PROJECT"
          }
        },
        "status": {
          "sources": {
            "human": {
              "fallback": "\u26a0\ufe0f UNKNOWN",
              "regex": "(\u2705 PRODUCTION READY|\u26a0\ufe0f NEEDS ATTENTION|\u274c NOT READY)"
            },
            "json": "$.final_recommendation.status",
            "machine": "VALIDATION_RESULT"
          },
          "transformations": {
            "FAIL": "\u274c Not ready",
            "PASS": "\u2705 Ready",
            "all_passed": "\u2705 Ready",
            "critical_failed": "\u274c Not ready",
            "some_failed": "\u26a0\ufe0f Needs attention"
          }
        },
        "total_checks": {
          "sources": {
            "human": {
              "regex": "Total checks: (\\d+)",
              "type": "integer"
            },
            "json": "$.summary.total_checks",
            "machine": "TOTAL_CHECKS"
          }
        },
        "validation_time": {
          "sources": {
            "human": {
              "fallback": "unknown",
              "regex": "Duration: (.+)"
            },
            "json": "$.metadata.validation_time",
            "machine": "DURATION"
          }
        }
      }
    },
    "pattern_assessment": {
      "section": "Pattern Assessment",
      "template_file": "RESPONSE_BLUEPRINTS.md",
      "variables": {
        "anti_patterns_detected": {
          "sources": {
            "human": {
              "regex": "Anti-patterns detected: (.+)"
            },
            "json": "$.anti_pattern_results.detected",
            "machine": "ANTI_PATTERNS"
          },
          "type": "array"
        },
        "patterns_checked": {
          "sources": {
            "human": {
              "regex": "Patterns checked: (\\d+)"
            },
            "json": "$.pattern_results.total_patterns",
            "machine": "PATTERN_CHECKS"
          }
        },
        "recommendations": {
          "sources": {
            "human": {
              "multiline": true,
              "regex": "Recommendations:\\n(.+?)(?=\\n\\n|$)"
            },
            "json": "$.pattern_results.recommendations",
            "machine": "PATTERN_RECOMMENDATIONS"
          },
          "type": "array"
        },
        "violations_found": {
          "sources": {
            "human": {
              "regex": "Violations: (\\d+)"
            },
            "json": "$.pattern_results.violations",
            "machine": "PATTERN_VIOLATIONS"
          }
        }
      }
    },
    "pr_comment": {
      "section": "PR Comment",
      "template_file": "RESPONSE_BLUEPRINTS.md",
      "variables": {
        "critical_issues": {
          "sources": {
            "human": {
              "multiline": true,
              "regex": "\u274c (.+)"
            },
            "json": "$.layer_results[?(@.results[*].status == 'FAIL')]",
            "machine": "LAYER:.*:FAIL"
          },
          "type": "array"
        },
        "score": {
          "sources": {
            "human": {
              "regex": "\\((\\d+)%\\)"
            },
            "json": "$.summary.passed_checks / $.summary.total_checks * 100",
            "machine": "SCORE"
          },
          "type": "integer"
        },
        "validation_status": {
          "sources": {
            "human": {
              "regex": "(\u2705|\u26a0\ufe0f|\u274c)"
            },
            "json": "$.summary.overall_result",
            "machine": "VALIDATION_RESULT"
          }
        },
        "warnings": {
          "sources": {
            "human": {
              "multiline": true,
              "regex": "\u26a0\ufe0f (.+)"
            },
            "json": "$.warnings",
            "machine": "WARNING:"
          },
          "type": "array"
        }
      }
    }
  },
  "title": "Context Binding Schema",
  "transformation_functions": {
    "basename": {
      "description": "Extract basename from file path",
      "implementation": "path.basename(value)"
    },
    "current_directory": {
      "description": "Get current directory name",
      "implementation": "path.basename(process.cwd())"
    },
    "current_timestamp": {
      "description": "Generate current timestamp",
      "implementation": "new Date().toISOString()"
    },
    "duration_string": {
      "description": "Format duration in human-readable format",
      "implementation": "formatDuration(value)"
    },
    "iso8601": {
      "description": "Format timestamp as ISO8601",
      "implementation": "new Date(value).toISOString()"
    }
  },
  "validation_rules": {
    "conditional_fields": {
      "critical_issues": "validation_status != '\u2705'",
      "issues_summary": "status != '\u2705 Ready'",
      "next_actions": "status != '\u2705 Ready'",
      "warnings": "validation_status == '\u26a0\ufe0f'"
    },
    "data_types": {
      "anti_patterns_detected": "array",
      "checks_passed": "integer",
      "critical_issues": "array",
      "recommendations": "array",
      "score": "integer",
      "total_checks": "integer",
      "validation_results": "array",
      "warnings": "array"
    },
    "required_fields": {
      "comprehensive_assessment": [
        "metadata",
        "validation_results",
        "final_recommendation"
      ],
      "mini_assessment": [
        "status",
        "checks_passed",
        "total_checks"
      ],
      "pattern_assessment": [
        "patterns_checked",
        "violations_found"
      ],
      "pr_comment": [
        "validation_status",
        "score"
      ]
    }
  },
  "version": "2.0.0"
}
